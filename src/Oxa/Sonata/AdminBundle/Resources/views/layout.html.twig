{% extends 'SonataAdminBundle::standard_layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/oxasonataadmin/css/lib/jquery.fancybox.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/oxasonataadmin/css/admin.css') }}">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript"
            src="{{ asset('bundles/oxasonataadmin/js/lib/jquery.fancybox.pack.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/oxasonataadmin/js/admin.js') }}"></script>
{% endblock %}

{% block logo %}
    {% spaceless %}
        <a class="logo" href="{{ url('sonata_admin_dashboard') }}">
            {% if 'single_image' == admin_pool.getOption('title_mode') or 'both' == admin_pool.getOption('title_mode') %}
                <img src="{{ asset(admin_pool.titlelogo) }}" alt="{{ admin_pool.title }}" style="max-width: 130px;;">
            {% endif %}
        </a>
    {% endspaceless %}
{% endblock %}

{% block side_bar_after_nav %}{% endblock %}

{% block sonata_page_content_nav %}
    {% if _tab_menu is not empty or _actions is not empty %}
        <nav class="navbar navbar-default" role="navigation">
            {% block tab_menu_navbar_header %}
                {% if _navbar_title is not empty %}
                    <div class="navbar-header">
                        <span class="navbar-brand">{{ _navbar_title|raw }}</span>
                    </div>
                {% endif %}
            {% endblock %}
            <div class="container-fluid">
                <div class="navbar-left">
                    {% if _tab_menu is not empty %}
                        {{ _tab_menu|raw }}
                    {% endif %}
                </div>
                <ul class="nav navbar-nav navbar-right">
                    {{ block('nav_bar_right') }}
                </ul>
            </div>
        </nav>
    {% endif %}
{% endblock sonata_page_content_nav %}

{% block side_bar_nav %}
    {% if app.security.token and is_granted('ROLE_SONATA_ADMIN') %}
        <ul class="sidebar-menu">
            {% for group in admin_pool.dashboardgroups %}
                {% set display = (group.roles is empty or is_granted('ROLE_SUPER_ADMIN') ) %}
                {% for role in group.roles if not display %}
                    {% set display = is_granted(role) %}
                {% endfor %}

                {# Do not display the group label if no item in group is available #}
                {% set item_count = 0 %}
                {% if display %}
                    {% for admin in group.items if item_count == 0 %}
                        {% if admin.hasroute('list') and admin.isGranted('LIST') %}
                            {% set item_count = item_count+1 %}
                        {% endif %}
                    {% endfor %}
                {% endif %}

                {% if display and (item_count > 0) %}
                    {% set active = false %}
                    {% for admin in group.items %}
                        {% if admin.hasroute('list') and admin.isGranted('LIST') and app.request.get('_sonata_admin') == admin.code %}
                            {% set active = true %}
                        {% endif %}
                    {% endfor %}
                    <li class="treeview{% if active %} active{% endif %}">
                        {% if group.items|length==1 %}
                            <a href=""
                               style="display: none"></a>{# Заглушка для скрипта treeview. Или так, или удалять класс .treeview выше #}
                            {% set admin = group.items|first %}
                            <a href="{{ admin.generateUrl('list') }}">
                                {% if group.icon|default() %}{{ group.icon|raw }}{% endif %}
                                <span>{{ admin.label|trans({}, admin.translationdomain) }}</span>
                            </a>
                        {% else %}
                            <a href="#">
                                {% if group.icon|default() %}{{ group.icon|raw }}{% endif %}
                                <span>{{ group.label|trans({}, group.label_catalogue) }}</span>
                                <i class="fa pull-right fa-angle-left"></i>
                            </a>
                            <ul class="treeview-menu{% if active %} active{% endif %}">
                                {% for admin in group.items %}
                                    {% if admin.hasroute('list') and admin.isGranted('LIST') %}
                                        <li{% if app.request.get('_sonata_admin') == admin.code %} class="active"{% endif %}>
                                            <a href="{{ admin.generateUrl('list') }}"><i
                                                        class="fa fa-angle-double-right"></i> {{ admin.label|trans({}, admin.translationdomain) }}
                                            </a></li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    {% endif %}
{% endblock side_bar_nav %}

{% block sonata_breadcrumb %}
    {% if _breadcrumb is not empty or action is defined %}
        <ol class="nav navbar-top-links breadcrumb">
            {% if _breadcrumb is empty %}
                {% if action is defined %}
                    {% for menu in admin.breadcrumbs(action) %}
                        {% if not loop.last %}
                            <li>
                                {% if menu.uri is not empty %}
                                    <a href="{{ menu.uri }}">{{ menu.label|raw }}</a>
                                {% else %}
                                    {{ menu.label }}
                                {% endif %}
                            </li>
                        {% else %}
                            {% set menu_label = menu.label|replace({" - ":""}) %}
                            <li class="active"><span>{% if menu.label|length==0 %}{{ menu.label }}{% else %}<a
                                        href="javascript:return false;" style="cursor: default;padding: 0"
                                        title="{{ menu_label }}">{{ menu_label|slice(0,15) }}</a>{% endif %}</span></li>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% else %}
                {{ _breadcrumb|raw }}
            {% endif %}
        </ol>
    {% endif %}
{% endblock sonata_breadcrumb %}

{% block nav_bar_right %}
    <li class="dropdown sonata-actions">
        {% if admin.hasRoute('create') and admin.isGranted('CREATE') %}
            <a href="{{ admin.generateUrl('create') }}">
                <i class="fa fa-plus-circle"></i>
                {{ 'link_action_create'|trans({}, 'SonataAdminBundle') }}
            </a>
        {% endif %}
    </li>
{% endblock %}