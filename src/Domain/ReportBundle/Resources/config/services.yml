services:
    # managers
    domain_report.manager.subscription_report_manager:
        class: Domain\ReportBundle\Manager\SubscriptionReportManager
        calls:
            - [ setContainer, [ '@service_container' ] ]
    domain_report.manager.category_report_manager:
        class: Domain\ReportBundle\Manager\CategoryReportManager
        calls:
            - [ setContainer, [ '@service_container' ] ]
    domain_report.manager.business_overview_report_manager:
        class: Domain\ReportBundle\Manager\BusinessOverviewReportManager
        arguments:
            - '@domain_business.manager.business_profile'
            - '@router'
            - '@kernel'
        calls:
            - [ setContainer, [ '@service_container' ] ]

    domain_report.manager.keywords_report_manager:
        class: Domain\ReportBundle\Manager\KeywordsReportManager
        arguments: [ '@doctrine.orm.entity_manager' ]

    # export services
    domain_report.exporter:
        class: Domain\ReportBundle\Service\Export\Exporter
        calls:
            - [ setContainer, [ '@service_container' ]]
    domain_report.exporter.subscription_pdf_exporter:
        class: Domain\ReportBundle\Service\Export\SubscriptionPdfExporter
        calls:
            - [ setTemplateEngine, [ '@templating' ]]
            - [ setPdfGenerator, [ '@spraed.pdf.generator' ]]
            - [ setSubscriptionReportManager, [ '@domain_report.manager.subscription_report_manager' ]]
    domain_report.exporter.subscription_excel_exporter:
        class: Domain\ReportBundle\Service\Export\SubscriptionExcelExporter
        calls:
            - [ setPhpExcel, [ '@phpexcel' ]]
            - [ setSubscriptionReportManager, [ '@domain_report.manager.subscription_report_manager' ]]
            - [ setTranslator, [ '@translator.default' ]]
    domain_report.exporter.category_pdf_exporter:
        class: Domain\ReportBundle\Service\Export\CategoryPdfExporter
        calls:
            - [ setTemplateEngine, [ '@templating' ]]
            - [ setPdfGenerator, [ '@spraed.pdf.generator' ]]
            - [ setCategoryReportManager, [ '@domain_report.manager.category_report_manager' ]]
    domain_report.exporter.category_excel_exporter:
        class: Domain\ReportBundle\Service\Export\CategoryExcelExporter
        calls:
            - [ setPhpExcel, [ '@phpexcel' ]]
            - [ setCategoryReportManager, [ '@domain_report.manager.category_report_manager' ]]
            - [ setTranslator, [ '@translator.default' ]]
    domain_report.exporter.business_overview_pdf_exporter:
        class: Domain\ReportBundle\Service\Export\BusinessOverviewPdfExporter
        calls:
            - [ setTemplateEngine, [ '@templating' ]]
            - [ setPdfGenerator, [ '@spraed.pdf.generator' ]]
            - [ setBusinessOverviewReportManager, [ '@domain_report.manager.business_overview_report_manager' ]]
    domain_report.exporter.business_overview_excel_exporter:
        class: Domain\ReportBundle\Service\Export\BusinessOverviewExcelExporter
        calls:
            - [ setPhpExcel, [ '@phpexcel' ]]
            - [ setBusinessOverviewReportManager, [ '@domain_report.manager.business_overview_report_manager' ]]
            - [ setTranslator, [ '@translator.default' ]]

    domain_report.google_analytics.data_fetcher:
        class: Domain\ReportBundle\Google\Analytics\DataFetcher
        parent: happyr.google_analytics.data_fetcher
        calls:
            - [ setClientProvider, [ '@domain_report.google_analytics.client_provider' ]]

    domain_report.google_analytics.client_provider:
        class: Domain\ReportBundle\Google\Analytics\ClientProvider
        arguments: ['analytics@infopaginas-142911.iam.gserviceaccount.com', %kernel.root_dir%/config/key.p12]

    domain_report.stemmer:
        class: Domain\ReportBundle\Service\StemmerService

    domain_report.manager.keywords:
        class: Domain\ReportBundle\Manager\KeywordsManager
        arguments: ['@doctrine.orm.entity_manager', '@domain_report.stemmer']

    domain_report.manager.search_log:
        class: Domain\ReportBundle\Manager\SearchLogManager
        arguments: ['@doctrine.orm.entity_manager', '@domain_report.manager.keywords']

    domain_report.manager.ad_usage:
        class: Domain\ReportBundle\Manager\AdUsageReportManager
        arguments: ['@doctrine.orm.entity_manager', '@oxa_dfp.manager', '@cache.provider.my_file_system']
    domain_report.manager.views_and_visitors:
        class: Domain\ReportBundle\Manager\ViewsAndVisitorsReportManager
        arguments: ['@domain_report.google_analytics.data_fetcher']

    domain_report.manager.interactions:
        class: Domain\ReportBundle\Manager\InteractionsReportManager
        arguments: ['@domain_report.google_analytics.data_fetcher']

    domain_report.exporter.excel:
        class: Domain\ReportBundle\Service\Export\BusinessReportExcelExporter
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@domain_report.manager.business_overview_report_manager'
            - '@domain_report.manager.keywords_report_manager'
            - '@domain_report.manager.ad_usage'
            - '@phpexcel'

    domain_report.exporter.pdf:
        class: Domain\ReportBundle\Service\Export\BusinessReportPdfExporter
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@domain_report.manager.business_overview_report_manager'
            - '@domain_report.manager.keywords_report_manager'
            - '@domain_report.manager.ad_usage'
            - '@templating'
            - '@spraed.pdf.generator'

    domain_report.manager.business_overview_report_api_manager:
            class: Domain\ReportBundle\Manager\BusinessOverviewReportApiManager
            arguments: [ '@service_container' ]
