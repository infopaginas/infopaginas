{% extends 'DomainReportBundle:Admin/Default:list.html.twig' %}

{% block list_table %}
    <div class="box box-primary">
        <div class="box-body table-responsive no-padding">
            {{ sonata_block_render_event('sonata.admin.list.table.top', { 'admin': admin }) }}

            {% block list_header %}{% endblock %}

            {% set batchactions = admin.batchactions %}
            {% if admin.interactionsData|length > 0 %}
                {% if admin.hasRoute('batch') %}
                    <form action="{{ admin.generateUrl('batch', {'filter': admin.filterParameters}) }}" method="POST" >
                    <input type="hidden" name="_sonata_csrf_token" value="{{ csrf_token }}">
                {% endif %}

                <table class="table table-bordered table-striped">
                    {% block table_header %}
                        <thead>
                        <tr class="sonata-ba-list-field-header">
                            {% for field_description in admin.list.elements %}
                                {% if admin.hasRoute('batch') and field_description.getOption('code') == '_batch' and batchactions|length > 0 %}
                                    <th class="sonata-ba-list-field-header sonata-ba-list-field-header-batch">
                                        <input type="checkbox" id="list_batch_checkbox">
                                    </th>
                                {% elseif field_description.getOption('code') == '_select' %}
                                    <th class="sonata-ba-list-field-header sonata-ba-list-field-header-select"></th>
                                {% elseif field_description.name == '_action' and app.request.isXmlHttpRequest %}
                                    {# Action buttons disabled in ajax view! #}
                                {% elseif field_description.getOption('ajax_hidden') == true and app.request.isXmlHttpRequest %}
                                    {# Disable fields with 'ajax_hidden' option set to true #}
                                {% else %}
                                    {% set sortable = false %}
                                    {% if field_description.options.sortable is defined and field_description.options.sortable %}
                                        {% set sortable             = true %}
                                        {% set sort_parameters      = admin.modelmanager.sortparameters(field_description, admin.datagrid) %}
                                        {% set current              = admin.datagrid.values._sort_by == field_description or admin.datagrid.values._sort_by.fieldName == sort_parameters.filter._sort_by %}
                                        {% set sort_active_class    = current ? 'sonata-ba-list-field-order-active' : '' %}
                                        {% set sort_by              = current ? admin.datagrid.values._sort_order : field_description.options._sort_order %}
                                    {% endif %}

                                    {% spaceless %}
                                        <th class="sonata-ba-list-field-header-{{ field_description.type}} {% if sortable %} sonata-ba-list-field-header-order-{{ sort_by|lower }} {{ sort_active_class }}{% endif %}">
                                            {% if sortable %}<a href="{{ admin.generateUrl('list', sort_parameters) }}">{% endif %}
                                                {{ admin.trans(field_description.label, {}, field_description.translationDomain) }}
                                                {% if sortable %}</a>{% endif %}
                                        </th>
                                    {% endspaceless %}
                                {% endif %}
                            {% endfor %}
                        </tr>
                        </thead>
                    {% endblock %}

                    {% block table_body %}
                        <tbody>
                            {% for record in admin.interactionsData %}
                                <tr>
                                    <td class="sonata-ba-list-field sonata-ba-list-field-string">
                                        {{ record['category'] }}
                                    </td>
                                    <td class="sonata-ba-list-field sonata-ba-list-field-string">
                                        {{ record['clicks'] }}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    {% endblock %}


                </table>
                {% if admin.hasRoute('batch') %}
                    </form>
                {% endif %}
            {% else %}
                <div class="callout callout-info">
                    {{ 'no_result'|trans({}, 'SonataAdminBundle') }}
                </div>
            {% endif %}

            {% block list_footer %}{% endblock %}

            {{ sonata_block_render_event('sonata.admin.list.table.bottom', { 'admin': admin }) }}
        </div>
    </div>

    {% block table_footer %}
        <div class="pull-right">
            {% if admin.hasRoute('export') and admin.isGranted("EXPORT") and admin.getExportFormats()|length and admin.interactionsData|length > 0 %}
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                        <i class="glyphicon glyphicon-export"></i>
                        {{ "label_export_download"|trans({}, "SonataAdminBundle") }}
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        {% for format in admin.getExportFormats() %}
                        <li>
                            <a href="{{ admin.generateUrl('export', admin.modelmanager.paginationparameters(admin.datagrid, 0) + {'format' : format}) }}">
                                <i class="glyphicon glyphicon-download"></i>
                                {{ format|upper }}
                            </a>
                        <li>
                            {% endfor %}
                    </ul>
                </div>

                &nbsp;-&nbsp;
            {% endif %}
        </div>
    {% endblock %}
{% endblock %}

{% set showPagination = false %}

{% block pager_results %}
    {% if showPagination %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block pager_links %}
    {% if showPagination %}
        {{ parent() }}
    {% endif %}
{% endblock %}