{% extends "DomainSearchBundle:Layout:base.html.twig" %}

{% block breakcrumbs %}
    <section id="breadcrumbs" class="breadcrumbs">
        <div class="container">
            <div class="row">
                <div class="crumbs">
                    <a href="{{ path('domain_search_catalog') }}">Catalog</a>
                    &nbsp;
                    {% if currentLocality %}
                        <span>&nbsp; »</span>

                        {% if currentCategory %}
                            <a href="{{ path('domain_search_catalog', {'localitySlug': currentLocality.getSlug() }) }}">{{ currentLocality.getName() }}</a>
                        {% else %}
                            <span>{{ currentLocality.getName() }}</span>
                        {% endif %}

                        {% if currentCategory %}
                            <span>&nbsp; »</span>

                            {% if currentSubcategory %}
                                <a href="{{ path('domain_search_catalog', {'localitySlug': currentLocality.getSlug(), 'categorySlug': currentCategory.getSlug() }) }}">{{ currentCategory.getName() }}</a>
                            {% else %}
                                <span>{{ currentCategory.getName() }}</span>
                            {% endif %}

                            {% if currentSubcategory %}
                                <span>&nbsp; »</span>
                                <span>{{ currentSubcategory.getName() }}</span>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block headerFilters %}{% endblock %}

{% block main %}
    <section id="search-results" class="search-results">
        <div class="container">
            <div class="row">
                {% if currentLocality == '' %}
                <div class="col-xs-12 list-block">
                    {% include 'DomainSearchBundle:Layout/widgets:catalog_localities_select_options.html.twig' %}
                </div>
                {% endif %}
                {% if currentCategory == '' and categories %}
                <div class="col-xs-12 list-block">
                    {% include 'DomainSearchBundle:Layout/widgets:catalog_categories_select_options.html.twig' %}
                </div>
                {% endif %}
                {% if currentSubcategory == '' and subcategories %}
                <div class="col-xs-12 list-block">
                    {% include 'DomainSearchBundle:Layout/widgets:catalog_subcategories_select_options.html.twig' %}
                </div>
                {% endif %}
            </div>

            <div class="row">
                <div class="col-xs-12 banner-block desc-banner">
                    {% if bannerFactory is not null %}
                        {% include 'DomainSiteBundle:Layout:widgets/banner_double_click_widget.html.twig' with { 'banner' :
                        bannerFactory.retrieve(constant('Domain\\BannerBundle\\Model\\TypeInterface::CODE_PORTAL_LEADERBOARD'))  }
                        %}
                    {% endif %}

                    {% if results.resultSet is defined and results.resultSet is not null and  results.resultSet is not empty %}
                        <div class="row">
                            <div class="col-md-9 list-block">
                                <div class="list-info">
                                    <div class="results-info">
                                        {% set amount = results.page * search.limit %}
                                        {% if amount > results.resultCount %}
                                            {% set amount = results.resultCount %}
                                        {% endif %}
                                        <span>
                                        {% trans with {'%page%': (results.page - 1) * search.limit + 1, '%amount%': amount, '%resultCount%': results.resultCount} %}%page%-%amount% of %resultCount% Results{% endtrans %}
                                    </span>
                                    <span>
                                        {% trans with {'%searchQuery%': search.query, '%searchLocationName%': search.locationValue.name} %}for %searchQuery% in %searchLocationName%{% endtrans %}
                                    </span>
                                    </div>
                                    <div class="sort-by"></div>
                                </div>
                                <div class="cards">
                                    {% if results.resultSet is defined and results.resultSet is not null %}
                                        {% for item in results.resultSet %}
                                            {% include 'DomainSearchBundle:Search:Templates/search_result_item.html.twig' with { 'item' : item, 'iterator' : loop.index } %}
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                            <aside class="map col-md-3">
                                {% if bannerFactory is not null %}
                                    {% include 'DomainSiteBundle:Layout:widgets/banner_double_click_widget.html.twig' with { 'banner' :
                                    bannerFactory.retrieve(constant('Domain\\BannerBundle\\Model\\TypeInterface::CODE_PORTAL'))  }
                                    %}
                                {% endif %}
                            </aside>
                        </div>
                        {% block pagination %}
                            {% include 'DomainSiteBundle:Layout:widgets/pagination.html.twig' with { 'page' : results.page, 'pageCount' : results.pageCount } %}
                        {% endblock %}
                    {% else %}
                        <div class="row">
                            <div class="col-md-9 list-block">
                                {% trans %}Sorry, no results were found.{% endtrans %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block scripts %}
    {{ parent() }}
    <script type="text/javascript">
        requirejs(['./{{ asset("/bundles/domainsite/scripts/common.js")}}'], function(common) {
            require(['{{asset("/bundles/domainsite/scripts/modules/searchpage.js")}}'], function(searchpage){
                var searchPage = new searchpage;
            })
        })
    </script>
    {% include "GoogleBundle:Analytics:async_universal.html.twig" %}
{% endblock%}
